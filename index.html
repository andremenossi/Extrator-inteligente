<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Selenium Extrator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel para compilar JSX no navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: transparent; overflow: hidden; user-select: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        /* Região de arraste da janela */
        .drag-region { -webkit-app-region: drag; }
        .no-drag { -webkit-app-region: no-drag; }
    </style>
<script type="importmap">
{
  "imports": {
    "lucide-react": "https://esm.sh/lucide-react@^0.560.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.1/",
    "react/": "https://esm.sh/react@^19.2.1/",
    "react": "https://esm.sh/react@^19.2.1"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-slate-900/95 border border-slate-700 text-white h-screen flex flex-col overflow-hidden">
    
    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel">
        // --- ÍCONES SVG (Substituindo Lucide para evitar dependências externas complexas no EXE) ---
        const Icons = {
            Database: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
            X: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            ExternalLink: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
            Check: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            MousePointer: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/><path d="m13 13 6 6"/></svg>,
            Play: (p) => <svg {...p} viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Square: (p) => <svg {...p} viewBox="0 0 24 24" fill="currentColor" stroke="none"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>
        };

        const { useState, useEffect } = React;
        
        // Integração com Electron
        const electron = window.require ? window.require('electron').ipcRenderer : null;

        const App = () => {
            const [status, setStatus] = useState('Pronto para Gravar');
            const [progress, setProgress] = useState(0);
            const [maxRows, setMaxRows] = useState(10);
            const [isRunning, setIsRunning] = useState(false);
            const [steps, setSteps] = useState({ BUTTON: null, DETAILS: null });

            useEffect(() => {
                if (electron) {
                    electron.send('setup-ipc-listener');

                    electron.on('status', (e, msg) => setStatus(msg));
                    electron.on('progress', (e, p) => setProgress(Math.round((p.current / p.total) * 100)));
                    
                    electron.on('element-captured', (e, data) => {
                        const { mode, selector, framePath, tagName, innerText } = data;
                        setSteps(prev => ({
                            ...prev,
                            [mode]: {
                                selector, framePath, tagName, completed: true,
                                desc: `${tagName} (${innerText.substring(0, 15)}...)`
                            }
                        }));
                        setStatus(`Elemento ${mode} Capturado!`);
                    });
                }
            }, []);

            const triggerSelect = (mode) => {
                setStatus(`Selecione o ${mode} no navegador...`);
                if(electron) electron.send('trigger-select', mode);
            };

            const startRun = () => {
                if (!steps.BUTTON) return setStatus("Precisa definir onde clicar (Botão)!");
                setIsRunning(true);
                if(electron) electron.send('start-selenium-run', { steps, maxRows });
            };

            const stopRun = () => {
                setIsRunning(false);
                if(electron) electron.send('stop-extraction');
            };

            const StepCard = ({ mode, label, step }) => (
                <div className={`p-3 rounded border mb-2 transition-all ${step ? 'bg-green-900/20 border-green-600' : 'bg-slate-800 border-slate-700'}`}>
                    <div className="flex justify-between items-center mb-1">
                        <span className="text-xs font-bold text-slate-400 uppercase">{label}</span>
                        {step ? <Icons.Check width={14} className="text-green-500"/> : <span className="w-3 h-3 rounded-full bg-slate-600"></span>}
                    </div>
                    
                    {step ? (
                        <div className="text-xs text-green-300 font-mono truncate">
                            FRAME: [{step.framePath.join(',')}]<br/>
                            SEL: {step.selector}
                        </div>
                    ) : (
                        <div className="text-xs text-slate-500 italic">Pendente...</div>
                    )}

                    <button 
                        onClick={() => triggerSelect(mode)}
                        className="mt-2 w-full text-xs bg-slate-700 hover:bg-slate-600 py-1 rounded text-white flex justify-center items-center gap-2"
                    >
                        <Icons.MousePointer width={10} /> {step ? 'Redefinir' : 'Selecionar Elemento'}
                    </button>
                </div>
            );

            return (
                <React.Fragment>
                    {/* Header */}
                    <div className="h-8 bg-slate-950 flex items-center justify-between px-3 drag-region">
                        <div className="flex items-center gap-2">
                            <Icons.Database width={14} className="text-amber-500"/>
                            <span className="text-[10px] font-bold tracking-widest text-slate-300">SELENIUM EXTRACTOR</span>
                        </div>
                        <button onClick={() => electron && electron.send('app-close')} className="text-slate-500 hover:text-white no-drag cursor-pointer">
                            <Icons.X width={14} />
                        </button>
                    </div>

                    <div className="flex-1 p-4 overflow-y-auto custom-scrollbar flex flex-col gap-3">
                        
                        {/* Status Bar */}
                        <div className="bg-black/40 rounded p-2 border border-slate-800">
                            <div className="flex justify-between items-end">
                                <span className="text-[10px] text-slate-500 font-bold">STATUS DO ROBÔ</span>
                                <span className="text-lg font-bold text-blue-400">{progress}%</span>
                            </div>
                            <p className="text-xs text-amber-400 font-mono truncate mt-1">{status}</p>
                            <div className="w-full bg-slate-800 h-1 mt-2 rounded overflow-hidden">
                                <div className="h-full bg-blue-500 transition-all" style={{width: `${progress}%`}}></div>
                            </div>
                        </div>

                        {/* Browser Link */}
                        <button 
                            onClick={() => electron && electron.send('open-browser')}
                            className="text-xs flex items-center justify-center gap-2 p-2 rounded bg-blue-600/20 hover:bg-blue-600/30 text-blue-200 border border-blue-500/30 transition-all"
                        >
                            <Icons.ExternalLink width={12} /> Abrir Navegador Alvo
                        </button>

                        <div className="border-t border-slate-800 my-1"></div>

                        {/* Steps */}
                        <div>
                            <StepCard mode="BUTTON" label="1. Botão (Ação)" step={steps.BUTTON} />
                            <StepCard mode="DETAILS" label="2. Dados (Extração)" step={steps.DETAILS} />
                        </div>

                        {/* Controls */}
                        <div className="mt-auto">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-xs text-slate-400">Repetir (Linhas):</span>
                                <input 
                                    type="number" value={maxRows} onChange={e => setMaxRows(Number(e.target.value))}
                                    className="w-16 bg-slate-950 border border-slate-700 text-center text-xs p-1 rounded focus:border-amber-500 outline-none"
                                />
                            </div>
                            
                            {!isRunning ? (
                                <button onClick={startRun} className="w-full py-3 bg-amber-600 hover:bg-amber-500 text-white font-bold rounded shadow-lg flex justify-center items-center gap-2 active:scale-95 transition-transform">
                                    <Icons.Play width={16} /> EXECUTAR ROBÔ
                                </button>
                            ) : (
                                <button onClick={stopRun} className="w-full py-3 bg-red-600 hover:bg-red-500 text-white font-bold rounded shadow-lg flex justify-center items-center gap-2 animate-pulse">
                                    <Icons.Square width={16} /> PARAR AGORA
                                </button>
                            )}
                        </div>
                    </div>
                </React.Fragment>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
